<% title "Dashboard" %>

<div class="well">
  <h2>Podcasts</h2>

  <table class="table table-striped" id="dashboard_podcast_table">
    <thead>
      <tr>
        <th>Name</th>
        <th># Episodes</th>
        <th>Last Episode</th>
        <th>Next Episode</th>
        <% if @settings.uri_key.present? && @settings.uri_token.present? %>
        <th>
          <a href="#" data-toggle="tooltip" title="according to uri.lv"><b>Subscribers</b></a>
        </th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% for podcast in @podcasts do %>
        <% present podcast do |podcast_presenter| %>
          <tr>
            <td><%= podcast_presenter.name %></td>
            <td><%= podcast_presenter.episodes_count %></td>
            <td class="<%= podcast_presenter.since_color_code %>"><%= raw(podcast_presenter.since_last_episode) %></td>
            <td><%= raw(podcast_presenter.until_next_episode) %></td>
            <% if @settings.uri_key.present? && @settings.uri_token.present? %>
            <td>
              <a href="#<%= podcast_presenter.name %>SubscribersModal" data-toggle="modal">
                <%= subscribers(podcast_presenter.name) %>
              </a>
          </td>
            <% end %>
          </tr>
          <%= render 'subscribers_chart', podcast: podcast %>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <% if @settings.gauges.present? && @settings.gauges_key.present? %>

  <h2>Traffic</h2>

  <%= content_tag :div, "", id: "traffic_chart", data: { traffic: traffic_data } %>

  <% end %>

  <h2>Recent Commits</h2>

  <table class="table table-striped" id="dashboard_commit_table">
    <thead>
      <tr>
        <th>Message</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <% for commit in @commits do %>
        <tr>
          <td><%= commit.message %></td>
          <td><%= commit.committed_date.strftime("%d.%m.%y %H:%M") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

</div><!-- /well -->
